Design
My design includes a document called helpers.py, which, among other things, contains the function that accesses the API. The lookup function takes a book_id in the format of an OLID, which is the standard identifier for the API. It then queries the API to get back information, including the book’s title, author, year of publication, cover, first sentence, and page count. There is also another function called small_lookup, which is meant for routes that might not need all the information that comes with lookup, and saves time. Helpers.py also includes the login_required function from the source code for the CS50 finance pset.
My application makes use of three main sqlite databases: users, friends, and shelved. Users handles all of the users and their passwords, friends handles which users are friends with which others, and shelved is where each user’s shelved books are stored.
Starting at the top of the app.py document, we have the standard templating for a Flask web application. The index function is self-explanatory, returning the homepage that users see when first logging in. The shelves function retrieves the users’ shelves and puts them into a data structure that is more easily readable by the html. The structure is a dictionary where the keys are the shelf names and the values are lists of dictionaries. These secondary dictionaries are for storing the book_id and the cover_url. I chose to have the shelved database include the cover_url, because it saves a lot of time when the app does not constantly have to query the API for the cover_url.
Continuing down, we come to the search function, which enables the book search engine. The user’s queries are put into the lookup function from helpers. The next function is book_profile, which generates a profile for a book based on the information it gets from the API. The next two functions, add_shelf and new are for adding a book to a shelf and creating a new shelf, respectively. I chose to make these two separate functions so I could differentiate between when the new shelf form was being submitted and when the add shelf form was being submitted. The html template for book_profile is quite complicated because of the pop-up that appears when “add to bookshelf” is clicked.
The next few functions are for friends. Friends() simply returns all of a user's existing friends and all of the users that have added them as friends. Friend_search is similar to the book search, but returns a list of friends instead of books. Add_friend and delete_friend update the sqlite database friends to either add or remove friend relationships between users. Finally, friend_profile returns a friend’s bookshelves. The code is very similar to the code used for the shelves route, which returns the user’s own bookshelves.
Lastly, the following three functions are adapted from CS50’s source code for the finance problem set, but represent a simple register/log in system
